<?xml version="1.0"?>

<project basedir="." name="portal-upgrade-test" xmlns:antelope="antlib:ise.antelope.tasks">
	<import file="../../../../../../../../build-test.xml" />

	<target name="check-mbean-attributes">
		<beanshell>
			<![CDATA[
				import javax.management.*;
				import javax.management.MBeanServer;
				import javax.management.ObjectName;
				import javax.management.remote.JMXConnector;
				import javax.management.remote.JMXConnectorFactory;
				import javax.management.remote.JMXServiceURL;

				ObjectName objectName = new ObjectName("com.liferay.portal.upgrade:classification=upgrade,name=UpgradeManager");

				String port = "1234";
				String hostname = "localhost";

				JMXServiceURL jmxServiceURL = new JMXServiceURL("service:jmx:rmi:///jndi/rmi://" + hostname + ":" + port + "/jmxrmi");
				JMXConnector jmxConnector = JMXConnectorFactory.connect(jmxServiceURL);

				MBeanServerConnection mBeanServerConnection = jmxConnector.getMBeanServerConnection();

				if (mBeanServerConnection.isRegistered(objectName)) {
					String result = (String)mBeanServerConnection.getAttribute(objectName, "Result");
					System.out.println("Result: " + result);
				} else {
					System.out.println("Not Registered");
				}
			]]>
		</beanshell>
	</target>
</project>